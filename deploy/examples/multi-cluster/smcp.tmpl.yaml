apiVersion: maistra.io/v2
kind: ServiceMeshControlPlane
metadata:
  name: basic
spec:
  addons:
    grafana:
      enabled: false
    kiali:
      enabled: false
    prometheus:
      enabled: false
  cluster:
    name: {{clusterNamePrefix}}-cluster
    network: {{clusterNamePrefix}}-network
    multiCluster:
      enabled: true
      meshNetworks:
        east-network:
          endpoints:
          - fromRegistry: east-cluster
          gateways:
#          - registryServiceName: east-west-gateway.istio-system.svc.cluster.local
          - address: aa627152025a24488a146a49edf6b5e9-e4dba2cf60788e0f.elb.us-west-2.amazonaws.com
            port: 15443
        west-network:
          endpoints:
          - fromRegistry: west-cluster
          gateways:
          - address: a7a2c0c994e7e42098d74de61099eeb8-05a8fba7c3a5b0c9.elb.us-east-1.amazonaws.com
            port: 15443
  gateways:
    ingress:
      # does not work
      enabled: false
    egress:
      # does not work
      enabled: false
    additionalIngress:
      east-west-gateway:
        enabled: true
        service:
          type: LoadBalancer
          metadata:
            annotations:
              service.beta.kubernetes.io/aws-load-balancer-type: nlb
            labels:
              istio: eastwestgateway
              app: istio-eastwestgateway
              topology.istio.io/network: {{clusterNamePrefix}}-network
          ports:
          - name: status-port
            port: 15021
            targetPort: 15021
          - name: tls
            port: 15443
            targetPort: 15443
          - name: tls-istiod
            port: 15012
            targetPort: 15012
          - name: tls-webhook
            port: 15017
            targetPort: 15017
        runtime:
          container:
            env:
              ISTIO_META_REQUESTED_NETWORK_VIEW: {{clusterNamePrefix}}-network
      routeConfig:
        enabled: false
    openshiftRoute:
      enabled: false
  general:
    logging:
      componentLevels:
        default: info
  mode: ClusterWide
  meshConfig:
    discoverySelectors:
    - matchLabels:
        istio-injection: enabled
  proxy:
    accessLogging:
      file:
        name: /dev/stdout
  security:
    dataPlane:
      mtls: true
    identity:
      type: ThirdParty
    manageNetworkPolicy: false
  techPreview:
    global:
      meshID: bookinfo-mesh
  tracing:
    type: None
